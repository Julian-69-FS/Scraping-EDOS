# Documentaci√≥n: Scripts de Scraping - Baja California

> **Ubicaci√≥n de los scripts:** `C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\scraping`
> **Fecha de documentaci√≥n:** Noviembre 2025
> **Autor original:** Julian
> **Prop√≥sito:** Automatizaci√≥n de descarga de documentos legales del estado de Baja California

---

## √çndice

1. [Descripci√≥n General](#1-descripci√≥n-general)
2. [Requisitos y Dependencias](#2-requisitos-y-dependencias)
3. [Estructura de Archivos](#3-estructura-de-archivos)
4. [Scripts Detallados](#4-scripts-detallados)
   - [4.1 Leyes.py](#41-leyespy)
   - [4.2 codigos.py](#42-codigospy)
   - [4.3 reglamentos.py](#43-reglamentospy)
   - [4.4 periodico.py](#44-periodicopy)
5. [Rutas de Entrada y Salida](#5-rutas-de-entrada-y-salida)
6. [Configuraci√≥n Necesaria](#6-configuraci√≥n-necesaria)
7. [C√≥mo Ejecutar](#7-c√≥mo-ejecutar)
8. [Consideraciones Importantes](#8-consideraciones-importantes)
9. [Posibles Errores y Soluciones](#9-posibles-errores-y-soluciones)
10. [Estructura de Metadatos](#10-estructura-de-metadatos)

---

## 1. Descripci√≥n General

Esta carpeta contiene scripts de **web scraping** dise√±ados para automatizar la descarga de documentos legales (PDFs) desde portales oficiales de Baja California.

### ¬øQu√© hacen estos scripts?

1. **Acceden autom√°ticamente** a p√°ginas web oficiales del gobierno de Baja California
2. **Navegan** por tablas HTML que contienen listados de documentos legales
3. **Extraen** informaci√≥n (metadatos) de cada documento
4. **Descargan** los archivos PDF asociados
5. **Guardan** los metadatos en archivos JSON para uso posterior

### Fuentes de datos:

| Script | Fuente | URL |
|--------|--------|-----|
| `Leyes.py` | Congreso de BC | https://www.congresobc.gob.mx/TrabajoLegislativo/Leyes |
| `codigos.py` | Poder Judicial de BC | https://transparencia.pjbc.gob.mx/paginas/MarcoJuridico.aspx?opc=1 |
| `reglamentos.py` | Poder Judicial de BC | https://transparencia.pjbc.gob.mx/paginas/MarcoJuridico.aspx?opc=2 |

---

## 2. Requisitos y Dependencias

### Python
- **Versi√≥n recomendada:** Python 3.8 o superior

### Librer√≠as necesarias

```bash
pip install selenium
pip install webdriver-manager
pip install requests
```

| Librer√≠a | Versi√≥n | Prop√≥sito |
|----------|---------|-----------|
| `selenium` | >= 4.0 | Automatizaci√≥n del navegador |
| `webdriver-manager` | >= 3.8 | Gesti√≥n autom√°tica de ChromeDriver |
| `requests` | >= 2.28 | Descarga de archivos PDF |

### Software adicional
- **Google Chrome** instalado en el sistema (el script usa Chrome en modo headless)

### Verificar instalaci√≥n

```bash
python --version
pip list | grep selenium
pip list | grep webdriver-manager
pip list | grep requests
```

---

## 3. Estructura de Archivos

```
BAJA CALIFORNIA/
‚îú‚îÄ‚îÄ scraping/
‚îÇ   ‚îú‚îÄ‚îÄ Leyes.py           # Scraper para leyes (Congreso BC)
‚îÇ   ‚îú‚îÄ‚îÄ codigos.py         # Scraper para c√≥digos (Poder Judicial)
‚îÇ   ‚îú‚îÄ‚îÄ reglamentos.py     # Scraper para reglamentos (Poder Judicial)
‚îÇ   ‚îî‚îÄ‚îÄ periodico.py       # [VAC√çO - No implementado]
‚îÇ
‚îú‚îÄ‚îÄ json_metadatos/        # Carpeta de salida para metadatos
‚îÇ   ‚îú‚îÄ‚îÄ metadatos_leyes.json
‚îÇ   ‚îú‚îÄ‚îÄ metadatos_codigos.json
‚îÇ   ‚îî‚îÄ‚îÄ metadatos_reglamentos.json
‚îÇ
‚îî‚îÄ‚îÄ [PDFs descargados en rutas configuradas]
```

---

## 4. Scripts Detallados

### 4.1 Leyes.py

#### Prop√≥sito
Descarga todas las leyes disponibles en el portal del Congreso de Baja California.

#### URL objetivo
```
https://www.congresobc.gob.mx/TrabajoLegislativo/Leyes
```

#### Flujo de ejecuci√≥n

```
1. Inicia Chrome en modo headless
2. Accede a la URL del Congreso
3. Espera 3 segundos para carga inicial
4. Selecciona "100" registros por p√°gina (m√°ximo disponible)
5. Espera 3 segundos adicionales
6. Lee JSON existente (si existe) para agregar nuevos datos
7. LOOP por cada p√°gina:
   a. Extrae filas de la tabla
   b. Por cada fila:
      - Extrae: nombre, fecha, estatus, tomo
      - Obtiene URL del PDF
      - Descarga el PDF
      - Guarda metadatos
   c. Busca bot√≥n "Siguiente"
   d. Si existe y no est√° deshabilitado, navega a siguiente p√°gina
   e. Si no hay m√°s p√°ginas, termina loop
8. Guarda todos los metadatos en JSON
9. Cierra navegador
```

#### Metadatos extra√≠dos

| Campo | Descripci√≥n | Columna en tabla |
|-------|-------------|------------------|
| `NOMBRE` | Nombre de la ley | Columna 0 |
| `FECHA PER OFIC` | Fecha del peri√≥dico oficial | Columna 3 |
| `ESTATUS` | Estado de la ley (vigente, abrogada, etc.) | Columna 4 |
| `TOMO` | Tomo del peri√≥dico oficial | Columna 5 |
| `URL` | Enlace al PDF | Columna 1 (enlace) |

#### Caracter√≠sticas especiales
- **Paginaci√≥n autom√°tica:** Navega por todas las p√°ginas disponibles
- **Acumulativo:** Lee JSON existente y agrega nuevos registros
- **Manejo de URLs relativas:** Completa URLs que no empiezan con `http`

---

### 4.2 codigos.py

#### Prop√≥sito
Descarga los c√≥digos legales desde el portal de transparencia del Poder Judicial de BC.

#### URL objetivo
```
https://transparencia.pjbc.gob.mx/paginas/MarcoJuridico.aspx?opc=1
```

#### Flujo de ejecuci√≥n

```
1. Inicia Chrome en modo headless
2. Accede a la URL del Poder Judicial
3. Espera a que cargue la tabla (ID: ContentPlaceHolder1_gvInformacion)
4. Extrae todas las filas de la tabla
5. Por cada fila:
   - Extrae: denominaci√≥n, fecha modificaci√≥n, fecha publicaci√≥n
   - Obtiene URL del PDF (columna 4)
   - Descarga el PDF
   - Guarda metadatos
6. Guarda metadatos en JSON
7. Cierra navegador
```

#### Metadatos extra√≠dos

| Campo | Descripci√≥n | Columna en tabla |
|-------|-------------|------------------|
| `titulo` | Denominaci√≥n del c√≥digo | Columna 0 |
| `Fecha de √∫ltima modificaci√≥n` | √öltima actualizaci√≥n | Columna 1 |
| `Fecha de publicaci√≥n` | Fecha de publicaci√≥n oficial | Columna 3 |
| `url` | Enlace al PDF | Columna 4 (enlace) |

#### Caracter√≠sticas especiales
- **Sin paginaci√≥n:** La tabla muestra todos los registros en una sola p√°gina
- **Estructura m√°s simple** que Leyes.py

---

### 4.3 reglamentos.py

#### Prop√≥sito
Descarga los reglamentos desde el portal de transparencia del Poder Judicial de BC.

#### URL objetivo
```
https://transparencia.pjbc.gob.mx/paginas/MarcoJuridico.aspx?opc=2
```

#### Flujo de ejecuci√≥n

```
1. Inicia Chrome en modo headless
2. Accede a la URL del Poder Judicial
3. Localiza el dropdown de cantidad de registros
4. Selecciona "Todo" (value="-1") para mostrar todos los registros
5. Espera 5 segundos para que cargue la tabla completa
6. Extrae todas las filas de la tabla
7. Por cada fila:
   - Extrae: denominaci√≥n, fecha modificaci√≥n, fecha publicaci√≥n
   - Obtiene URL del PDF (columna 4)
   - Descarga el PDF
   - Guarda metadatos
8. Guarda metadatos en JSON
9. Cierra navegador
```

#### Metadatos extra√≠dos

| Campo | Descripci√≥n | Columna en tabla |
|-------|-------------|------------------|
| `titulo` | Denominaci√≥n del reglamento | Columna 0 |
| `Fecha de √∫ltima modificaci√≥n` | √öltima actualizaci√≥n | Columna 1 |
| `Fecha de publicaci√≥n` | Fecha de publicaci√≥n oficial | Columna 3 |
| `url` | Enlace al PDF | Columna 4 (enlace) |

#### Caracter√≠sticas especiales
- **Selecci√≥n de "Todo":** Usa un dropdown para mostrar todos los registros
- **Espera de 5 segundos:** Necesario porque cargar todos los registros toma tiempo

---

### 4.4 periodico.py

#### Estado: NO IMPLEMENTADO

Este archivo est√° **vac√≠o** (0 bytes). Probablemente estaba planificado para hacer scraping del peri√≥dico oficial de Baja California, pero no fue desarrollado.

#### Acci√≥n requerida
Si se necesita implementar, seguir la estructura de los otros scripts como plantilla.

---

## 5. Rutas de Entrada y Salida

### Rutas de DESCARGA de PDFs (SALIDA)

| Script | Ruta de descarga |
|--------|------------------|
| `Leyes.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Leyes` |
| `codigos.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Codigos` |
| `reglamentos.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Reglamentos` |

### Ruta de METADATOS JSON (SALIDA)

**Todos los scripts guardan en:**
```
C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\json_metadatos
```

| Script | Archivo JSON generado |
|--------|----------------------|
| `Leyes.py` | `metadatos_leyes.json` |
| `codigos.py` | `metadatos_codigos.json` |
| `reglamentos.py` | `metadatos_reglamentos.json` |

### ‚ö†Ô∏è IMPORTANTE: Modificar rutas

**Antes de ejecutar**, la siguiente persona debe **modificar las rutas** en las variables:

```python
# En cada script, modificar estas l√≠neas:
PDF_DOWNLOAD_PATH = r"C:\NUEVA\RUTA\PARA\PDFs"
JSON_METADATA_PATH = r"C:\NUEVA\RUTA\PARA\json_metadatos"
```

---

## 6. Configuraci√≥n Necesaria

### Configuraci√≥n de Chrome (ya incluida en scripts)

```python
chrome_options = Options()
chrome_options.add_argument("--headless=new")      # Sin interfaz gr√°fica
chrome_options.add_argument("--disable-gpu")       # Deshabilitar GPU
chrome_options.add_argument("--no-sandbox")        # Necesario en algunos sistemas
chrome_options.add_argument("--window-size=1920,1080")  # Tama√±o de ventana
chrome_options.add_argument('--ignore-certificate-errors')  # Ignorar errores SSL
chrome_options.add_argument('--log-level=3')       # Reducir logs
```

### Timeouts

| Script | WebDriverWait | Timeout de descarga |
|--------|---------------|---------------------|
| `Leyes.py` | 15 segundos | 30 segundos |
| `codigos.py` | 10 segundos | 30 segundos |
| `reglamentos.py` | 10 segundos | 30 segundos |

---

## 7. C√≥mo Ejecutar

### Ejecuci√≥n individual

```bash
# Desde la carpeta de scripts
cd "C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\scraping"

# Ejecutar cada script
python Leyes.py
python codigos.py
python reglamentos.py
```

### Ejecuci√≥n en secuencia (todos)

```bash
python Leyes.py && python codigos.py && python reglamentos.py
```

### Verificar resultados

```bash
# Ver PDFs descargados
dir "C:\Users\julii\Documents\BAJA CALIFORNIA\Leyes"
dir "C:\Users\julii\Documents\BAJA CALIFORNIA\Codigos"
dir "C:\Users\julii\Documents\BAJA CALIFORNIA\Reglamentos"

# Ver metadatos generados
type "C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\json_metadatos\metadatos_leyes.json"
```

---

## 8. Consideraciones Importantes

### ‚ö†Ô∏è CR√çTICO

1. **Modificar rutas antes de usar:** Las rutas est√°n hardcodeadas para el usuario `julii`. Cambiarlas seg√∫n el nuevo entorno.

2. **Conexi√≥n a internet:** Los scripts requieren conexi√≥n estable para:
   - Acceder a las p√°ginas web
   - Descargar los PDFs

3. **Chrome debe estar instalado:** Selenium usa Chrome. Sin Chrome instalado, los scripts fallar√°n.

4. **Las p√°ginas web pueden cambiar:** Si el Congreso o el Poder Judicial modifican su sitio web, los scripts dejar√°n de funcionar. Habr√° que actualizar:
   - IDs de elementos HTML
   - Estructura de tablas
   - URLs

### üìù NOTAS T√âCNICAS

1. **Modo headless:** Los scripts corren sin abrir ventana del navegador. Para debug, comentar la l√≠nea:
   ```python
   # chrome_options.add_argument("--headless=new")
   ```

2. **Nombres de archivos:** Los nombres de PDFs se limpian autom√°ticamente:
   - Se eliminan caracteres especiales (`<>:"/\|?*`)
   - Se limita a 100 caracteres m√°ximo
   - Se agregan `.pdf` si no lo tienen

3. **Leyes.py es acumulativo:** Lee el JSON existente y agrega nuevos registros. Los otros scripts **sobrescriben** el JSON cada vez.

4. **Errores silenciosos:** Los scripts usan `continue` en los `except`, lo que significa que si un documento falla, contin√∫a con el siguiente sin mostrar error.

### üîÑ MANTENIMIENTO

- **Revisar peri√≥dicamente** si las URLs siguen funcionando
- **Verificar estructura HTML** si hay cambios en los portales
- **Actualizar selectores** (IDs, clases) si cambian

---

## 9. Posibles Errores y Soluciones

### Error: "ChromeDriver not found"

**Causa:** webdriver-manager no puede descargar ChromeDriver.

**Soluci√≥n:**
```bash
pip install --upgrade webdriver-manager
# O descargar manualmente desde: https://chromedriver.chromium.org/
```

### Error: "Element not found" / Timeout

**Causa:** La p√°gina cambi√≥ su estructura o tarda m√°s en cargar.

**Soluci√≥n:**
1. Aumentar el tiempo de espera:
   ```python
   wait = WebDriverWait(driver, 30)  # Aumentar a 30 segundos
   ```
2. Verificar que los IDs de elementos sigan siendo correctos

### Error: "Connection refused" / Timeout en descarga

**Causa:** Problemas de red o el servidor est√° lento.

**Soluci√≥n:**
1. Verificar conexi√≥n a internet
2. Aumentar timeout de requests:
   ```python
   response = requests.get(url, timeout=60)  # Aumentar a 60
   ```

### Error: "Permission denied" al guardar archivos

**Causa:** No hay permisos de escritura en la carpeta destino.

**Soluci√≥n:**
1. Ejecutar como administrador
2. Verificar que la carpeta existe y tiene permisos de escritura
3. Cambiar la ruta de destino

### Los PDFs se descargan pero est√°n vac√≠os o corruptos

**Causa:** El servidor retorna HTML de error en lugar del PDF.

**Soluci√≥n:**
1. Verificar manualmente que la URL del PDF funciona
2. Agregar validaci√≥n del Content-Type en la respuesta

---

## 10. Estructura de Metadatos

### metadatos_leyes.json

```json
[
  {
    "NOMBRE": "Ley de Acceso de las Mujeres a una Vida Libre de Violencia...",
    "FECHA PER OFIC": "2008-07-25",
    "ESTATUS": "Vigente",
    "TOMO": "CXIV",
    "URL": "https://www.congresobc.gob.mx/..."
  }
]
```

### metadatos_codigos.json y metadatos_reglamentos.json

```json
[
  {
    "titulo": "C√≥digo Civil para el Estado de Baja California",
    "Fecha de √∫ltima modificaci√≥n": "2023-05-15",
    "Fecha de publicaci√≥n": "1974-03-01",
    "url": "https://transparencia.pjbc.gob.mx/..."
  }
]
```

---

## Resumen R√°pido

| Aspecto | Detalle |
|---------|---------|
| **Lenguaje** | Python 3.8+ |
| **Dependencias** | selenium, webdriver-manager, requests |
| **Navegador** | Chrome (headless) |
| **Entrada** | URLs de portales gubernamentales |
| **Salida PDFs** | Carpetas configurables |
| **Salida JSON** | `json_metadatos/metadatos_*.json` |
| **Paginaci√≥n** | Solo `Leyes.py` tiene paginaci√≥n |
| **Script vac√≠o** | `periodico.py` no implementado |

---

> **√öltima actualizaci√≥n de documentaci√≥n:** Noviembre 2025
