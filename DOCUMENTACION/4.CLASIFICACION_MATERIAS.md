# Documentación: Sistema de Clasificación Automática de Documentos Legales por Materia

> **Ubicación del archivo de referencia:** `C:\Users\julii\Documents\Practicas\resumen_clasificacion_materias.txt`
> **Ubicación de scripts:** `/home/julian69/agregar_materias_[ESTADO].py`
> **Fecha de documentación:** Noviembre 2025
> **Autor original:** Julian
> **Propósito:** Clasificación automática de documentos legales mexicanos por rama del derecho

---

## Índice

1. [Descripción General](#1-descripción-general)
2. [¿Qué es el Campo "materia"?](#2-qué-es-el-campo-materia)
3. [Catálogo de Materias Legales](#3-catálogo-de-materias-legales)
4. [Arquitectura del Sistema](#4-arquitectura-del-sistema)
5. [Estructura del Script Python](#5-estructura-del-script-python)
6. [Lógica de Clasificación](#6-lógica-de-clasificación)
7. [Workflow de Procesamiento](#7-workflow-de-procesamiento)
8. [Estados Procesados](#8-estados-procesados)
9. [Estructura de Carpetas](#9-estructura-de-carpetas)
10. [Peculiaridades Técnicas](#10-peculiaridades-técnicas)
11. [Comandos Útiles](#11-comandos-útiles)
12. [Casos de Uso](#12-casos-de-uso)
13. [Limitaciones y Consideraciones](#13-limitaciones-y-consideraciones)
14. [Mejoras Futuras](#14-mejoras-futuras)

---

## 1. Descripción General

### ¿Qué es este sistema?

Es un **sistema de clasificación automática** que agrega un campo `"materia"` a archivos JSON que contienen metadatos de documentos legales de diferentes estados de México.

### ¿Qué problema resuelve?

Los documentos legales (leyes, códigos, reglamentos, acuerdos) necesitan ser categorizados por **rama del derecho** para facilitar:

- Búsqueda y filtrado eficiente
- Organización de grandes volúmenes de información
- Análisis estadístico de legislación
- Indexación en motores de búsqueda

### Flujo general

```
┌─────────────────────┐     ┌─────────────────────┐     ┌─────────────────────┐
│   Archivos JSON     │     │  Script Python de   │     │   Archivos JSON     │
│   (sin materia)     │ ──► │   Clasificación     │ ──► │   (con materia)     │
└─────────────────────┘     └─────────────────────┘     └─────────────────────┘

Antes:                                                   Después:
{                                                        {
  "titulo": "Código Civil",                               "titulo": "Código Civil",
  "Contenido": "..."                                      "materia": ["civil"],
}                                                          "Contenido": "..."
                                                         }
```

---

## 2. ¿Qué es el Campo "materia"?

### Definición

El campo `"materia"` identifica la(s) rama(s) del derecho a la que pertenece cada documento legal.

### Formato

```json
"materia": ["materia1", "materia2", "materia3"]
```

**Es un ARRAY** porque un documento puede pertenecer a **múltiples ramas del derecho simultáneamente**.

### Ejemplos

#### Documento con una materia:
```json
{
  "titulo": "Código Civil del Estado",
  "materia": ["civil"],
  "Contenido": "..."
}
```

#### Documento con múltiples materias:
```json
{
  "titulo": "Ley de Transparencia y Protección de Datos Personales",
  "materia": ["transparencia", "derechos humanos", "administrativo"],
  "Contenido": "..."
}
```

#### Documento especializado:
```json
{
  "titulo": "Código de Ética de la Fiscalía Anticorrupción",
  "materia": ["penal", "fiscal", "anticorrupción", "ética"],
  "Contenido": "..."
}
```

---

## 3. Catálogo de Materias Legales

El sistema utiliza **37 categorías estandarizadas** aplicables a todos los estados:

| # | Materia | Descripción |
|---|---------|-------------|
| 1 | `constitucional` | Constituciones estatales y reformas |
| 2 | `civil` | Derecho civil, familiar, sucesiones |
| 3 | `penal` | Delitos, sanciones, ejecución de penas |
| 4 | `administrativo` | Organización gubernamental, trámites |
| 5 | `fiscal` | Impuestos, hacienda, presupuesto |
| 6 | `laboral` | Trabajo, sindicatos, relaciones laborales |
| 7 | `electoral` | Procesos electorales, partidos políticos |
| 8 | `derechos humanos` | Protección de derechos fundamentales |
| 9 | `transparencia` | Acceso a información, datos personales |
| 10 | `género` | Igualdad de género, violencia contra mujeres |
| 11 | `derechos de la niñez` | Protección de niños y adolescentes |
| 12 | `salud` | Sistema de salud, servicios médicos |
| 13 | `educación` | Sistema educativo, universidades |
| 14 | `cultura` | Arte, patrimonio cultural, museos |
| 15 | `desarrollo social` | Asistencia social, combate a pobreza |
| 16 | `urbanismo` | Desarrollo urbano, ordenamiento territorial |
| 17 | `ambiental` | Medio ambiente, recursos naturales |
| 18 | `protección civil` | Emergencias, desastres naturales |
| 19 | `seguridad pública` | Policía, prevención del delito |
| 20 | `ciencia y tecnología` | Innovación, investigación científica |
| 21 | `deporte` | Cultura física, actividad deportiva |
| 22 | `municipal` | Gobierno municipal, cabildos |
| 23 | `turismo` | Desarrollo turístico |
| 24 | `comunicación social` | Radio, televisión, medios |
| 25 | `movilidad` | Transporte, vialidad, tránsito |
| 26 | `agrario` | Desarrollo rural, campo |
| 27 | `económico` | Desarrollo económico, competitividad |
| 28 | `anticorrupción` | Combate a corrupción, contraloría |
| 29 | `notariado` | Servicios notariales, fedatarios |
| 30 | `registral` | Registros públicos |
| 31 | `energía` | Desarrollo energético |
| 32 | `migratorio` | Migración, movilidad humana |
| 33 | `ética` | Códigos de conducta, ética pública |
| 34 | `parlamentario` | Congreso, poder legislativo |
| 35 | `auditoría` | Fiscalización, rendición de cuentas |
| 36 | `judicial` | Poder judicial, tribunales |
| 37 | `participación ciudadana` | Mecanismos de participación |
| 38 | `general` | Documentos sin categoría específica |

---

## 4. Arquitectura del Sistema

### Diagrama de componentes

```
┌──────────────────────────────────────────────────────────────────┐
│                    SISTEMA DE CLASIFICACIÓN                       │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   ENTRADA       │    │  PROCESAMIENTO  │    │   SALIDA     │ │
│  │                 │    │                 │    │              │ │
│  │  Carpeta JSON   │───►│  Script Python  │───►│ JSON + campo │ │
│  │  del estado     │    │  clasificador   │    │ "materia"    │ │
│  │                 │    │                 │    │              │ │
│  └─────────────────┘    └────────┬────────┘    └──────────────┘ │
│                                  │                               │
│                    ┌─────────────┴─────────────┐                │
│                    │                           │                │
│           ┌────────▼────────┐        ┌────────▼────────┐       │
│           │ clasificar_por_ │        │ procesar_       │       │
│           │ palabras_clave()│        │ archivos()      │       │
│           │                 │        │                 │       │
│           │ • Analiza título│        │ • Recorre JSON  │       │
│           │ • Detecta claves│        │ • Aplica clasif.│       │
│           │ • Retorna array │        │ • Guarda cambios│       │
│           └─────────────────┘        └─────────────────┘       │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

### Componentes principales

| Componente | Función |
|------------|---------|
| Script Python | Ejecuta la clasificación por estado |
| Función `clasificar_por_palabras_clave()` | Analiza título y retorna materias |
| Función `procesar_archivos()` | Itera, clasifica y guarda |
| Catálogo de palabras clave | Diccionario de términos por materia |

---

## 5. Estructura del Script Python

### Plantilla base

```python
#!/usr/bin/env python3
"""
Script para agregar campo 'materia' a documentos legales
Estado: [NOMBRE_ESTADO]
"""

import os
import json
from pathlib import Path
from collections import defaultdict

# Ruta base del estado
BASE_DIR = r"C:\Users\julii\Documents\Practicas\drive\[ESTADO]\json"


def clasificar_por_palabras_clave(titulo: str) -> list:
    """
    Clasifica un documento según palabras clave en su título.

    Args:
        titulo: Nombre/título del documento legal

    Returns:
        Lista de materias identificadas
    """
    titulo_lower = titulo.lower()
    materias = []

    # === CONSTITUCIONAL ===
    if 'constitución' in titulo_lower or 'constitucional' in titulo_lower:
        materias.append('constitucional')

    # === CIVIL ===
    if 'civil' in titulo_lower or 'familia' in titulo_lower:
        materias.append('civil')

    # === PENAL ===
    if any(palabra in titulo_lower for palabra in
           ['penal', 'delito', 'sanción', 'fiscalía', 'ministerio público']):
        materias.append('penal')

    # ... (más reglas de clasificación)

    # === GENERAL (fallback) ===
    if not materias:
        materias.append('general')

    return materias


def procesar_archivos():
    """
    Procesa todos los archivos JSON en la carpeta base.
    Agrega el campo 'materia' a cada documento.
    """
    stats = defaultdict(int)
    procesados = 0
    errores = 0

    # Recorrer recursivamente
    for root, dirs, files in os.walk(BASE_DIR):
        for filename in files:
            if not filename.endswith('.json'):
                continue

            filepath = os.path.join(root, filename)

            try:
                # Leer archivo
                with open(filepath, 'r', encoding='utf-8') as f:
                    data = json.load(f)

                # Verificar que sea objeto (no lista)
                if isinstance(data, list):
                    print(f"OMITIDO (formato lista): {filename}")
                    errores += 1
                    continue

                # Obtener título (manejar variantes)
                titulo = data.get('titulo') or data.get('Titulo', '')

                if not titulo:
                    print(f"SIN TÍTULO: {filename}")
                    errores += 1
                    continue

                # Clasificar
                materias = clasificar_por_palabras_clave(titulo)

                # Agregar campo materia
                data['materia'] = materias

                # Guardar archivo
                with open(filepath, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=2)

                # Estadísticas
                procesados += 1
                for m in materias:
                    stats[m] += 1

            except Exception as e:
                print(f"ERROR en {filename}: {e}")
                errores += 1

    # Reportar resultados
    print(f"\n{'='*60}")
    print(f"PROCESAMIENTO COMPLETADO")
    print(f"{'='*60}")
    print(f"Archivos procesados: {procesados}")
    print(f"Archivos con error/omitidos: {errores}")
    print(f"\nDistribución de materias:")
    for materia, count in sorted(stats.items(), key=lambda x: -x[1]):
        print(f"  {materia}: {count}")


if __name__ == "__main__":
    procesar_archivos()
```

### Funciones principales

#### `clasificar_por_palabras_clave(titulo)`

| Aspecto | Descripción |
|---------|-------------|
| **Entrada** | String con el título del documento |
| **Salida** | Lista de materias (array) |
| **Lógica** | Busca palabras clave en el título |
| **Fallback** | Si no encuentra nada → `["general"]` |

#### `procesar_archivos()`

| Aspecto | Descripción |
|---------|-------------|
| **Función** | Recorre archivos y aplica clasificación |
| **Recursivo** | Procesa todas las subcarpetas |
| **Manejo de errores** | Reporta pero continúa |
| **Estadísticas** | Genera reporte al final |

---

## 6. Lógica de Clasificación

### Reglas de prioridad

```
1. Términos específicos primero
   Ejemplo: "código civil" antes de solo "civil"

2. Evitar falsos positivos
   Ejemplo: "Aguascalientes" NO debe clasificarse como "ambiental" por contener "agua"

3. Términos generales después
   Ejemplo: "administrativo" como categoría amplia

4. Fallback: "general"
   Si no se encuentra ninguna palabra clave
```

### Ejemplos de clasificación

| Título | Materias asignadas |
|--------|-------------------|
| `Código Civil del Estado` | `["civil"]` |
| `Ley Electoral` | `["electoral"]` |
| `Ley de Transparencia y Acceso a la Información` | `["transparencia", "administrativo"]` |
| `Ley General de Salud Mental` | `["salud"]` |
| `Reglamento de Tránsito Municipal` | `["movilidad", "municipal"]` |
| `Código de Ética del Poder Judicial` | `["judicial", "ética"]` |
| `Ley para la Igualdad entre Mujeres y Hombres` | `["género", "derechos humanos"]` |
| `Decreto de Creación del Instituto` | `["general"]` |

### Palabras clave por materia (ejemplos)

```python
PALABRAS_CLAVE = {
    'constitucional': ['constitución', 'constitucional', 'reforma constitucional'],
    'civil': ['civil', 'familia', 'matrimonio', 'divorcio', 'sucesión', 'herencia'],
    'penal': ['penal', 'delito', 'sanción', 'fiscalía', 'ministerio público', 'prisión'],
    'fiscal': ['fiscal', 'hacienda', 'impuesto', 'tributario', 'presupuesto', 'ingreso'],
    'laboral': ['trabajo', 'trabajador', 'sindicato', 'empleo', 'laboral'],
    'electoral': ['electoral', 'elección', 'voto', 'partido político', 'sufragio'],
    'transparencia': ['transparencia', 'acceso a la información', 'datos personales'],
    'ambiental': ['ambiente', 'ecología', 'ecológico', 'forestal', 'residuo', 'contaminación'],
    # ... más categorías
}
```

---

## 7. Workflow de Procesamiento

### Pasos para procesar un nuevo estado

```
┌─────────────────────────────────────────────────────────────────┐
│  PASO 1: EXPLORAR                                                │
│  • Identificar ruta del estado                                   │
│  • Listar subcarpetas                                            │
│  • Contar archivos JSON                                          │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  PASO 2: ANALIZAR MUESTRA                                        │
│  • Ver estructura de archivos JSON                               │
│  • Extraer títulos de ejemplo                                    │
│  • Identificar patrones específicos del estado                   │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  PASO 3: ADAPTAR SCRIPT                                          │
│  • Copiar script base                                            │
│  • Cambiar BASE_DIR                                              │
│  • Ajustar reglas si es necesario                                │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  PASO 4: EJECUTAR                                                │
│  • python3 agregar_materias_[ESTADO].py                          │
│  • Monitorear progreso                                           │
└────────────────────────────┬────────────────────────────────────┘
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  PASO 5: VERIFICAR Y REPORTAR                                    │
│  • Verificar campo materia en muestras                           │
│  • Generar estadísticas                                          │
│  • Documentar resultados                                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. Estados Procesados

### Registro de procesamiento

| Estado | Ruta | Archivos | Script | Fecha | Top 3 Materias |
|--------|------|----------|--------|-------|----------------|
| Aguascalientes | `drive\AGUAS\json` | 384 | `agregar_materias_aguas.py` | 2025-01-19 | general (117), municipal (52), educación (31) |
| Campeche | `drive\CAMPECHE\json` | 441 | `agregar_materias_campeche.py` | 2025-01-19 | municipal (185), general (165), fiscal (64) |
| Guerrero | `drive\GUERRERO\json` | 589 | Script en sesión | 2025-11 | (procesado) |

**Total acumulado:** 1400+ archivos procesados

### Estados pendientes (lista referencial)

- Baja California
- Baja California Sur
- Chiapas
- Chihuahua
- Coahuila
- Colima
- Durango
- Guanajuato
- Hidalgo
- Jalisco
- Michoacán
- Morelos
- Nayarit
- Nuevo León
- Oaxaca
- Puebla
- Querétaro
- Quintana Roo
- San Luis Potosí
- Sinaloa
- Sonora
- Tabasco
- Tamaulipas
- Tlaxcala
- Veracruz
- Yucatán
- Zacatecas

---

## 9. Estructura de Carpetas

### Estructura típica por estado

```
C:\Users\julii\Documents\Practicas\drive\[ESTADO]\json\
├── Acuerdo/
│   ├── documento1.json
│   ├── documento2.json
│   └── ...
├── Código/
│   └── ...
├── Coordinación/
│   └── ...
├── Decreto/
│   └── ...
├── Ley/
│   └── ...
├── Lineamiento/
│   └── ...
├── Programa/
│   └── ...
├── Regla/
│   └── ...
└── Reglamento/
    └── ...
```

### Estructura de archivo JSON

#### Antes del procesamiento:
```json
{
  "titulo": "Ley de Educación del Estado",
  "Contenido": "Artículo 1. La presente ley...",
  "ordenamiento": "LEY",
  "jurisdiccion": "ESTATAL",
  "fuente_oficial": "GUERRERO"
}
```

#### Después del procesamiento:
```json
{
  "titulo": "Ley de Educación del Estado",
  "materia": ["educación"],
  "Contenido": "Artículo 1. La presente ley...",
  "ordenamiento": "LEY",
  "jurisdiccion": "ESTATAL",
  "fuente_oficial": "GUERRERO"
}
```

---

## 10. Peculiaridades Técnicas

### Variantes de nombres de campos

| Variante | Manejo |
|----------|--------|
| `titulo` (minúscula) | Soportado |
| `Titulo` (mayúscula) | Soportado |
| Sin campo título | Se omite el archivo |

```python
titulo = data.get('titulo') or data.get('Titulo', '')
```

### Archivos con formato lista

Algunos archivos JSON son arrays `[]` en lugar de objetos `{}`. Estos se omiten:

```python
if isinstance(data, list):
    print(f"OMITIDO (formato lista): {filename}")
    continue
```

### Evitar falsos positivos

Ejemplo problemático: "Aguascalientes" contiene "agua"

```python
# MAL: Esto clasificaría Aguascalientes como ambiental
if 'agua' in titulo_lower:
    materias.append('ambiental')

# BIEN: Ser más específico
if any(palabra in titulo_lower for palabra in
       ['agua potable', 'aguas residuales', 'recursos hídricos']):
    materias.append('ambiental')
```

### Codificación UTF-8

Siempre usar UTF-8 para caracteres especiales:

```python
with open(filepath, 'r', encoding='utf-8') as f:
    data = json.load(f)

with open(filepath, 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)
```

---

## 11. Comandos Útiles

### Exploración

```bash
# Contar archivos JSON
find "/ruta/json" -name "*.json" | wc -l

# Listar subcarpetas
ls "/ruta/json"

# Ver estructura de un JSON
head -50 "/ruta/archivo.json"
```

### Verificación

```bash
# Verificar campo materia en un archivo
python3 -c "
import json
data = json.load(open('archivo.json', 'r', encoding='utf-8'))
print(data.get('materia', 'NO TIENE'))
"

# Buscar documentos con múltiples materias
find "/ruta" -name "*.json" -exec python3 -c "
import json, sys
data = json.load(open(sys.argv[1], 'r', encoding='utf-8'))
if 'materia' in data and len(data['materia']) > 2:
    print(f\"{data['titulo']}: {data['materia']}\")
" {} \;
```

### Ejecución

```bash
# Ejecutar script de clasificación
python3 agregar_materias_[ESTADO].py

# Ejecutar con logging a archivo
python3 agregar_materias_[ESTADO].py > resultado_[ESTADO].log 2>&1
```

---

## 12. Casos de Uso

### 1. Búsqueda y filtrado

```python
# Buscar todas las leyes penales
for archivo in archivos_json:
    if 'penal' in archivo['materia']:
        resultados.append(archivo)
```

### 2. Generación de estadísticas

```python
# Contar documentos por materia
from collections import Counter
materias = Counter()
for archivo in archivos_json:
    for m in archivo['materia']:
        materias[m] += 1
```

### 3. API REST (ejemplo Flask)

```python
@app.route('/api/documentos')
def buscar_documentos():
    materia = request.args.get('materia')
    return [doc for doc in documentos if materia in doc['materia']]
```

### 4. Recomendaciones

```python
# Recomendar documentos similares por materia
def recomendar(documento_actual):
    materias = documento_actual['materia']
    return [doc for doc in todos_docs
            if any(m in doc['materia'] for m in materias)]
```

### 5. Dashboard de análisis

```python
# Datos para gráfico de distribución
import matplotlib.pyplot as plt
plt.bar(materias.keys(), materias.values())
plt.title('Distribución de Legislación por Materia')
```

---

## 13. Limitaciones y Consideraciones

### Limitaciones actuales

| Limitación | Descripción | Impacto |
|------------|-------------|---------|
| **Basado en título** | Solo analiza el título, no el contenido completo | Puede perder contexto |
| **Palabras clave** | Sistema basado en reglas, no ML | Posibles falsos positivos/negativos |
| **Archivos lista** | No procesa JSONs con formato array | Algunos archivos quedan sin clasificar |
| **Idioma** | Optimizado para español de México | Limitado a documentos en español |

### Consideraciones de uso

1. **Revisión manual recomendada** para documentos críticos o ambiguos
2. **Actualizar palabras clave** cuando se identifiquen nuevos patrones
3. **Verificar resultados** con muestras aleatorias después del procesamiento
4. **Documentar excepciones** para futura referencia

---

## 14. Mejoras Futuras

### Corto plazo

- [ ] Análisis del contenido completo (no solo título)
- [ ] Base de datos de sinónimos legales
- [ ] Interfaz para revisión manual de casos ambiguos

### Mediano plazo

- [ ] Implementación con Machine Learning (clasificación supervisada)
- [ ] API REST para clasificación en tiempo real
- [ ] Exportación a formatos adicionales (CSV, Excel, SQL)

### Largo plazo

- [ ] Integración con IA generativa para análisis contextual
- [ ] Sistema de retroalimentación para mejorar clasificación
- [ ] Dashboard web interactivo

---

## Ventajas del Sistema

| Ventaja | Descripción |
|---------|-------------|
| **Automatizado** | Procesa cientos de archivos en segundos |
| **Escalable** | Fácil de aplicar a nuevos estados |
| **Flexible** | Soporta múltiples materias por documento |
| **Robusto** | Maneja errores sin detenerse |
| **Informativo** | Genera estadísticas automáticas |
| **Reutilizable** | Scripts adaptables fácilmente |
| **Estandarizado** | Mismas 37 categorías para todos los estados |

---

## Resumen Rápido

| Aspecto | Detalle |
|---------|---------|
| **Lenguaje** | Python 3.x |
| **Entrada** | Archivos JSON en carpetas por estado |
| **Salida** | Mismo JSON + campo `"materia": [...]` |
| **Categorías** | 37 materias legales + "general" |
| **Método** | Clasificación por palabras clave en título |
| **Formato materia** | Array (permite múltiples) |
| **Ubicación scripts** | `/home/julian69/agregar_materias_*.py` |

---

> **Última actualización de documentación:** Noviembre 2025

