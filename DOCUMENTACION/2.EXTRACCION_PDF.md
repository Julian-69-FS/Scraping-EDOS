# Documentaci√≥n: Scripts de Extracci√≥n de Contenido PDF - Baja California

> **Ubicaci√≥n de los scripts:** `C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\scrips`
> **Fecha de documentaci√≥n:** Noviembre 2025
> **Autor original:** Julian
> **Prop√≥sito:** Extracci√≥n autom√°tica de texto y tablas de archivos PDF de documentos legales

---

## √çndice

1. [Descripci√≥n General](#1-descripci√≥n-general)
2. [Requisitos y Dependencias](#2-requisitos-y-dependencias)
3. [Estructura de Archivos](#3-estructura-de-archivos)
4. [Arquitectura del Sistema](#4-arquitectura-del-sistema)
5. [Funciones Principales](#5-funciones-principales)
6. [Rutas de Entrada y Salida](#6-rutas-de-entrada-y-salida)
7. [C√≥mo Ejecutar](#7-c√≥mo-ejecutar)
8. [Flujo de Procesamiento](#8-flujo-de-procesamiento)
9. [Caracter√≠sticas Avanzadas](#9-caracter√≠sticas-avanzadas)
10. [Estructura del JSON de Salida](#10-estructura-del-json-de-salida)
11. [Consideraciones Importantes](#11-consideraciones-importantes)
12. [Posibles Errores y Soluciones](#12-posibles-errores-y-soluciones)
13. [Mantenimiento y Extensi√≥n](#13-mantenimiento-y-extensi√≥n)

---

## 1. Descripci√≥n General

Esta carpeta contiene scripts de **extracci√≥n de contenido** dise√±ados para procesar archivos PDF de documentos legales y convertirlos a formato JSON estructurado.

### ¬øQu√© hacen estos scripts?

1. **Leen archivos PDF** de una carpeta espec√≠fica
2. **Detectan autom√°ticamente** si el PDF es digital o escaneado
3. **Extraen texto** usando pdfplumber (digital) o OCR/Tesseract (escaneado)
4. **Detectan y extraen tablas** preserv√°ndolas como JSON embebido
5. **Limpian el contenido** eliminando encabezados, pies de p√°gina, m√°rgenes laterales
6. **Corrigen saltos de l√≠nea** para reconstruir p√°rrafos correctamente
7. **Guardan el resultado** en un archivo JSON estructurado

### Relaci√≥n con los scripts de scraping

```
[SCRAPING] ‚Üí Descarga PDFs ‚Üí [EXTRACCI√ìN] ‚Üí Genera JSON con contenido
     ‚Üì                              ‚Üì
  Leyes.py                    leyes-PDF.py
  codigos.py                  codigo-PDF.py
  reglamentos.py              reglamentos-PDF.py
```

---

## 2. Requisitos y Dependencias

### Python
- **Versi√≥n recomendada:** Python 3.8 o superior

### Dependencias OBLIGATORIAS

```bash
pip install pdfplumber
```

| Librer√≠a | Versi√≥n | Prop√≥sito |
|----------|---------|-----------|
| `pdfplumber` | >= 0.7 | Extracci√≥n de texto y tablas de PDFs digitales |

### Dependencias OPCIONALES (para funcionalidades avanzadas)

```bash
# Para OCR (PDFs escaneados)
pip install pytesseract pdf2image pillow opencv-python

# Para archivos Word (.docx)
pip install python-docx

# Para archivos Word antiguos (.doc) - Solo Windows
pip install pywin32
```

| Librer√≠a | Prop√≥sito |
|----------|-----------|
| `pytesseract` | OCR para PDFs escaneados |
| `pdf2image` | Convertir PDF a im√°genes para OCR |
| `pillow` | Manipulaci√≥n de im√°genes |
| `opencv-python` | Preprocesamiento de im√°genes para OCR |
| `python-docx` | Lectura de archivos .docx |
| `pywin32` | Lectura de archivos .doc antiguos (Windows) |

### Software adicional para OCR

1. **Tesseract-OCR:** https://github.com/tesseract-ocr/tesseract
   - Windows: Descargar instalador
   - Agregar al PATH o configurar `pytesseract.pytesseract.tesseract_cmd`

2. **Poppler:** Necesario para `pdf2image`
   - Windows: https://github.com/osber11/poppler-windows/releases
   - Agregar `bin/` al PATH

### Verificar instalaci√≥n

```bash
python -c "import pdfplumber; print('pdfplumber OK')"
python -c "import pytesseract; print('pytesseract OK')"
python -c "from pdf2image import convert_from_path; print('pdf2image OK')"
```

---

## 3. Estructura de Archivos

```
BAJA CALIFORNIA/
‚îú‚îÄ‚îÄ scrips/                          # Scripts de extracci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ codigo-PDF.py               # Extractor para c√≥digos
‚îÇ   ‚îú‚îÄ‚îÄ leyes-PDF.py                # Extractor para leyes
‚îÇ   ‚îî‚îÄ‚îÄ reglamentos-PDF.py          # Extractor para reglamentos
‚îÇ
‚îú‚îÄ‚îÄ Codigos/                         # PDFs de entrada (c√≥digos)
‚îú‚îÄ‚îÄ Leyes/                           # PDFs de entrada (leyes)
‚îú‚îÄ‚îÄ Reglamentos/                     # PDFs de entrada (reglamentos)
‚îÇ
‚îî‚îÄ‚îÄ contenido/                       # JSON de salida
    ‚îú‚îÄ‚îÄ codigo-contenido.json
    ‚îú‚îÄ‚îÄ leyes-contenido.json
    ‚îî‚îÄ‚îÄ reglamentos-contenido.json
```

### Nota importante sobre los scripts

Los tres scripts (`codigo-PDF.py`, `leyes-PDF.py`, `reglamentos-PDF.py`) son **ID√âNTICOS** en su l√≥gica. La √∫nica diferencia son las rutas de entrada y salida configuradas en la funci√≥n `main()`.

---

## 4. Arquitectura del Sistema

### Diagrama de flujo general

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        ENTRADA                                   ‚îÇ
‚îÇ                    Carpeta con PDFs                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   DETECCI√ìN DE TIPO                              ‚îÇ
‚îÇ         ¬øPDF digital o escaneado?                                ‚îÇ
‚îÇ         ¬øEs realmente PDF o Word disfrazado?                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PDF DIGITAL    ‚îÇ   ‚îÇ PDF ESCANEADO   ‚îÇ
‚îÇ  (pdfplumber)   ‚îÇ   ‚îÇ (OCR/Tesseract) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                     ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 EXTRACCI√ìN DE TABLAS                             ‚îÇ
‚îÇ         Detectar tablas ‚Üí Validar que sean reales                ‚îÇ
‚îÇ         Convertir a JSON embebido                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     LIMPIEZA                                     ‚îÇ
‚îÇ  - Eliminar encabezados/pies repetitivos                         ‚îÇ
‚îÇ  - Eliminar m√°rgenes laterales (cintas)                          ‚îÇ
‚îÇ  - Eliminar texto fragmentado                                    ‚îÇ
‚îÇ  - Corregir saltos de l√≠nea                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       SALIDA                                     ‚îÇ
‚îÇ                  Archivo JSON                                    ‚îÇ
‚îÇ           [{Titulo, contenido}, ...]                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 5. Funciones Principales

### 5.1 Detecci√≥n y clasificaci√≥n

| Funci√≥n | Descripci√≥n |
|---------|-------------|
| `detectar_tipo_archivo_real()` | Detecta tipo real del archivo leyendo magic bytes (PDF, DOCX, DOC) |
| `es_pdf_escaneado()` | Determina si un PDF es escaneado (sin texto seleccionable) |

### 5.2 Extracci√≥n de contenido

| Funci√≥n | Descripci√≥n |
|---------|-------------|
| `extraer_contenido_pdf()` | **Funci√≥n principal** - Orquesta toda la extracci√≥n de un PDF |
| `extraer_texto_con_ocr()` | Extrae texto de PDFs escaneados usando Tesseract |
| `extraer_contenido_word()` | Extrae contenido de archivos .docx |
| `extraer_contenido_doc_antiguo()` | Extrae contenido de archivos .doc (Word 97-2003) |

### 5.3 Manejo de tablas

| Funci√≥n | Descripci√≥n |
|---------|-------------|
| `convertir_tabla_a_json_string()` | Convierte tabla extra√≠da a formato JSON string |
| `_es_tabla_real()` | Valida que una detecci√≥n sea tabla real (no texto alineado) |
| `_tiene_cuadricula_completa()` | Verifica que haya l√≠neas formando cuadr√≠cula |
| `extraer_tablas_ocr()` | Intenta detectar tablas en im√°genes OCR |

### 5.4 Limpieza de texto

| Funci√≥n | Descripci√≥n |
|---------|-------------|
| `limpiar_texto()` | Normaliza espacios y saltos de l√≠nea |
| `detectar_y_eliminar_texto_fragmentado()` | Elimina cintas laterales (texto letra por letra) |
| `corregir_saltos_linea()` | Une l√≠neas para reconstruir p√°rrafos |
| `detectar_encabezado_pie()` | Detecta patrones repetitivos de encabezados/pies |
| `eliminar_encabezados_pies_contextual()` | Elimina encabezados, pies y m√°rgenes detectados |
| `detectar_texto_rotado_margenes()` | Detecta texto en m√°rgenes laterales |
| `limpiar_titulo_archivo()` | Limpia prefijos num√©ricos del nombre del archivo |

### 5.5 Procesamiento por lotes

| Funci√≥n | Descripci√≥n |
|---------|-------------|
| `procesar_carpeta_pdfs()` | Procesa todos los PDFs de una carpeta |
| `main()` | Punto de entrada - configura rutas y ejecuta |

---

## 6. Rutas de Entrada y Salida

### Configuraci√≥n actual (hardcodeada en `main()`)

| Script | Carpeta de entrada (PDFs) | Archivo de salida (JSON) |
|--------|---------------------------|--------------------------|
| `codigo-PDF.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Codigos` | `...\contenido\codigo-contenido.json` |
| `leyes-PDF.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Leyes` | `...\contenido\leyes-contenido.json` |
| `reglamentos-PDF.py` | `C:\Users\julii\Documents\BAJA CALIFORNIA\Reglamentos` | `...\contenido\reglamentos-contenido.json` |

### ‚ö†Ô∏è IMPORTANTE: Modificar rutas antes de usar

Editar la funci√≥n `main()` al final de cada script:

```python
def main():
    # MODIFICAR ESTAS DOS L√çNEAS:
    ruta_carpeta = r"C:\NUEVA\RUTA\A\PDFs"
    archivo_salida = r"C:\NUEVA\RUTA\salida.json"
```

---

## 7. C√≥mo Ejecutar

### Ejecuci√≥n b√°sica

```bash
# Desde la carpeta de scripts
cd "C:\Users\julii\Documents\Practicas\drive\BAJA CALIFORNIA\scrips"

# Ejecutar cada script
python codigo-PDF.py
python leyes-PDF.py
python reglamentos-PDF.py
```

### Salida esperada en consola

```
üöÄ Iniciando extracci√≥n de archivos PDF
   MODO: Extracci√≥n exhaustiva de PDFs
======================================================================

üìä CAPACIDADES DEL SISTEMA:
----------------------------------------------------------------------
‚úÖ OCR (Tesseract): Disponible - PDFs escaneados
----------------------------------------------------------------------

üîç ESTRATEGIA DE EXTRACCI√ìN:
  1. Extracci√≥n de texto y tablas de PDFs
  2. Detecci√≥n autom√°tica de PDFs escaneados (con OCR)
  3. Extracci√≥n exhaustiva de tablas como JSON
  4. Limpieza profunda de encabezados/pies/fragmentos
  5. Correcci√≥n de saltos de l√≠nea
======================================================================

üìÅ Carpeta: C:\Users\julii\Documents\BAJA CALIFORNIA\Codigos
üìä Total de archivos PDF encontrados: 15
üìã Orden de procesamiento:
   1. Codigo Civil.pdf
   2. Codigo Penal.pdf
   ...
--------------------------------------------------
üìÑ [1/15] Procesando: Codigo Civil.pdf
  üìÑ Tipo: PDF con texto digital
    ‚úì Tabla real validada en p√°gina 5
    ‚úì Tabla real validada en p√°gina 12
  üßπ Encabezados detectados: 3
  üßπ Pies de p√°gina detectados: 2
  üîß Eliminando texto fragmentado...
  ‚úÖ Completado - Progreso total: 6.67%
```

---

## 8. Flujo de Procesamiento

### Paso 1: Detecci√≥n del tipo de archivo

```python
# El script detecta el tipo REAL del archivo (no solo por extensi√≥n)
tipo = detectar_tipo_archivo_real(ruta_pdf)
# Posibles valores: 'pdf', 'docx', 'doc_antiguo', 'rtf', 'desconocido'
```

### Paso 2: Verificaci√≥n de PDF escaneado

```python
if es_pdf_escaneado(ruta_pdf):
    # Usar OCR (Tesseract)
    texto = extraer_texto_con_ocr(ruta_pdf)
else:
    # Usar pdfplumber (m√°s r√°pido y preciso)
    texto = extraer_con_pdfplumber(ruta_pdf)
```

### Paso 3: Extracci√≥n de tablas

```python
# Configuraci√≥n optimizada para detectar tablas
tablas = pagina.find_tables(table_settings={
    "vertical_strategy": "lines",
    "horizontal_strategy": "lines",
    "snap_tolerance": 3,
    "join_tolerance": 3,
    ...
})

# VALIDACI√ìN CR√çTICA: Solo tablas reales
if _es_tabla_real(tabla_data, pagina, table_bbox):
    tabla_json = convertir_tabla_a_json_string(tabla_data, contador)
```

### Paso 4: Limpieza del texto

1. **Detectar encabezados/pies repetitivos** (aparecen en >25% de p√°ginas)
2. **Detectar m√°rgenes laterales** (cintas con nombre de ley)
3. **Eliminar texto fragmentado** (letras sueltas: "C O N S T I T U C I √ì N")
4. **Corregir saltos de l√≠nea** (unir palabras cortadas: "legisla-\nci√≥n" ‚Üí "legislaci√≥n")

### Paso 5: Generaci√≥n del JSON

```python
# Estructura del JSON de salida
[
  {
    "Titulo": "Nombre del documento (sin extensi√≥n ni prefijos num√©ricos)",
    "contenido": "Texto completo con tablas embebidas como JSON..."
  },
  ...
]
```

---

## 9. Caracter√≠sticas Avanzadas

### 9.1 Detecci√≥n de tablas reales vs falsas

El script tiene validaci√≥n **MUY ESTRICTA** para evitar falsos positivos:

```python
def _es_tabla_real(tabla_data, page, table_bbox):
    # PASO 1: Verificar cuadr√≠cula f√≠sica (l√≠neas verticales Y horizontales)
    # PASO 2: Verificar estructura m√≠nima (‚â•2 columnas, ‚â•2 filas)
    # PASO 3: Verificar densidad de celdas (‚â•30% llenas)
    # PASO 4: Detectar patrones de NO-tabla (firmas, texto alineado)
    # PASO 5: Verificar encabezado diferente de datos
```

**Rechaza:**
- Texto alineado sin bordes
- Firmas y nombres alineados
- Listas con vi√±etas
- Secciones centradas

### 9.2 Tablas embebidas como JSON

Las tablas se insertan en el texto como JSON strings:

```
...texto normal del documento...
{"tabla_1":{"columnas":["Columna1","Columna2"],"filas":[{"columna_1":"dato1","columna_2":"dato2"}]}}
...contin√∫a el texto...
```

### 9.3 Correcci√≥n inteligente de saltos de l√≠nea

```python
# REGLAS:
# 1. NUNCA cortar palabras
# 2. Unir guiones: "legisla-\nci√≥n" ‚Üí "legislaci√≥n"
# 3. Detectar fin de bloque por contexto (Art√≠culo, Cap√≠tulo, etc.)
# 4. Respetar puntuaci√≥n fuerte (. ; : ! ?)
```

### 9.4 Eliminaci√≥n de cintas laterales

Detecta y elimina texto fragmentado t√≠pico de documentos legales:

```
ANTES:                          DESPU√âS:
C                               (eliminado)
O                               (eliminado)
N                               (eliminado)
S                               (eliminado)
T                               (eliminado)
I                               (eliminado)
T                               (eliminado)
U                               (eliminado)
C                               (eliminado)
I                               (eliminado)
√ì                               (eliminado)
N                               (eliminado)

Art√≠culo 1. El texto...         Art√≠culo 1. El texto...
```

### 9.5 OCR mejorado para PDFs escaneados

```python
# Caracter√≠sticas del OCR:
# - DPI 300 (alta calidad)
# - Preprocesamiento de imagen (binarizaci√≥n, eliminaci√≥n de ruido)
# - Idiomas: espa√±ol + ingl√©s
# - Filtrado de firmas, sellos y ruido
# - Detecci√≥n de tablas en im√°genes
```

---

## 10. Estructura del JSON de Salida

### Formato general

```json
[
  {
    "Titulo": "C√≥digo Civil del Estado de Baja California",
    "contenido": "LIBRO PRIMERO\nDE LAS PERSONAS\nT√çTULO PRIMERO\n..."
  },
  {
    "Titulo": "C√≥digo Penal del Estado de Baja California",
    "contenido": "LIBRO PRIMERO\nDISPOSICIONES GENERALES\n..."
  }
]
```

### Contenido con tablas embebidas

```json
{
  "Titulo": "Ley de Ingresos",
  "contenido": "Art√≠culo 1. Los ingresos del Estado...\n{\"tabla_1\":{\"columnas\":[\"Concepto\",\"Monto\"],\"filas\":[{\"columna_1\":\"Impuestos\",\"columna_2\":\"$1,000,000\"}]}}\nArt√≠culo 2. La recaudaci√≥n..."
}
```

### Notas sobre el formato

1. **Titulo:** Nombre del archivo sin extensi√≥n ni prefijos num√©ricos
2. **contenido:** Texto en una sola l√≠nea (saltos de l√≠nea escapados como `\n`)
3. **Tablas:** Embebidas como JSON strings dentro del contenido
4. **Codificaci√≥n:** UTF-8 con `ensure_ascii=False`

---

## 11. Consideraciones Importantes

### ‚ö†Ô∏è CR√çTICO

1. **Rutas hardcodeadas:** Modificar `main()` antes de usar en otro entorno

2. **Dependencias opcionales:** Sin OCR, solo procesa PDFs digitales

3. **Tiempo de procesamiento:**
   - PDF digital: ~1-5 segundos por archivo
   - PDF escaneado con OCR: ~30-120 segundos por p√°gina

4. **Memoria:** PDFs grandes o con muchas im√°genes pueden consumir mucha RAM

5. **Microsoft Word requerido:** Para archivos `.doc` antiguos, necesita Word instalado

### üìù NOTAS T√âCNICAS

1. **Orden de procesamiento:** Los archivos se ordenan:
   - Primero por n√∫mero (si tienen prefijo num√©rico)
   - Luego alfab√©ticamente

2. **Validaci√≥n de tablas:** Muy estricta para evitar falsos positivos. Puede omitir tablas v√°lidas con formato inusual.

3. **Encabezados/pies:** Se detectan patrones que aparecen en >25% de las p√°ginas

4. **Texto fragmentado:** Se elimina agresivamente. Puede eliminar contenido v√°lido si est√° muy espaciado.

5. **Encoding:** Todo se maneja en UTF-8. Caracteres especiales (tildes, √±) se preservan.

### üîß PAR√ÅMETROS CONFIGURABLES

En la funci√≥n `extraer_contenido_pdf()`:

```python
# Configuraci√≥n de detecci√≥n de tablas
table_settings={
    "snap_tolerance": 3,      # Tolerancia para alinear l√≠neas
    "join_tolerance": 3,      # Tolerancia para unir l√≠neas
    "edge_min_length": 3,     # Longitud m√≠nima de l√≠neas
    "min_words_vertical": 3,  # Palabras m√≠nimas vertical
    ...
}
```

En `es_pdf_escaneado()`:

```python
# Umbral para considerar PDF como escaneado
return len(texto_total.strip()) < 50  # Menos de 50 caracteres
```

---

## 12. Posibles Errores y Soluciones

### Error: "OCR no disponible"

**Causa:** pytesseract, pdf2image o Tesseract no instalados.

**Soluci√≥n:**
```bash
pip install pytesseract pdf2image pillow
# Instalar Tesseract-OCR desde: https://github.com/tesseract-ocr/tesseract
```

### Error: "No se pudo procesar el PDF"

**Causas posibles:**
- PDF corrupto
- PDF protegido con contrase√±a
- PDF con formato no est√°ndar

**Soluci√≥n:**
1. Verificar que el PDF se abre correctamente en un visor
2. Si tiene contrase√±a, desprotegerlo primero
3. Intentar convertir a PDF/A con otra herramienta

### Error: "Memory Error" o proceso muy lento

**Causa:** PDF muy grande o con muchas im√°genes.

**Soluci√≥n:**
1. Dividir el PDF en partes m√°s peque√±as
2. Reducir DPI del OCR (cambiar 300 a 150):
   ```python
   imagenes = convert_from_path(ruta_pdf, dpi=150)
   ```

### Las tablas no se detectan correctamente

**Causa:** Tablas sin bordes visibles o con formato inusual.

**Soluci√≥n:**
1. Ajustar `table_settings` para ser menos estricto
2. Cambiar estrategia de `"lines"` a `"text"`:
   ```python
   "vertical_strategy": "text",
   "horizontal_strategy": "text",
   ```

### Texto fragmentado no se elimina

**Causa:** Patr√≥n de fragmentaci√≥n diferente al esperado.

**Soluci√≥n:**
1. Agregar nuevos patrones a `patrones_cinta_lateral` en `detectar_y_eliminar_texto_fragmentado()`
2. Ajustar umbrales de detecci√≥n

### Caracteres extra√±os en el JSON

**Causa:** Problemas de encoding.

**Soluci√≥n:**
1. Verificar que el archivo se lee con `encoding='utf-8'`
2. La salida ya usa `ensure_ascii=False` para preservar caracteres especiales

---

## 13. Mantenimiento y Extensi√≥n

### Agregar soporte para nuevo tipo de documento

1. Crear funci√≥n `extraer_contenido_[tipo]()` siguiendo el patr√≥n existente
2. Agregar detecci√≥n en `detectar_tipo_archivo_real()`
3. Agregar llamada en `extraer_contenido_pdf()` seg√∫n el tipo detectado

### Modificar patrones de limpieza

Editar las listas de patrones en:
- `patrones_cinta_lateral` - Cintas laterales
- `patrones_eliminar` - Encabezados/pies gen√©ricos
- `patrones_excluir` - Contenido que NO debe eliminarse

### Crear script para otro tipo de documento

1. Copiar cualquiera de los 3 scripts existentes
2. Modificar solo la funci√≥n `main()`:
   ```python
   def main():
       ruta_carpeta = r"NUEVA_RUTA_PDFs"
       archivo_salida = r"NUEVA_RUTA_salida.json"
   ```

### Mejorar detecci√≥n de tablas

Ajustar par√°metros en `_es_tabla_real()`:
- `columnas_con_contenido < 2` - M√≠nimo columnas
- `(filled / total) < 0.30` - Densidad m√≠nima de celdas
- `firmas_count >= 2` - Umbral de detecci√≥n de firmas

---

## Resumen R√°pido

| Aspecto | Detalle |
|---------|---------|
| **Lenguaje** | Python 3.8+ |
| **Dependencia principal** | pdfplumber |
| **Dependencias OCR** | pytesseract, pdf2image, Tesseract-OCR, poppler |
| **Entrada** | Carpeta con archivos PDF |
| **Salida** | Archivo JSON con array de {Titulo, contenido} |
| **Soporta** | PDF digital, PDF escaneado (OCR), DOCX, DOC |
| **Tablas** | Embebidas como JSON string en el contenido |
| **Limpieza** | Encabezados, pies, m√°rgenes, texto fragmentado |
| **Tiempo** | ~1-5s (digital), ~30-120s/p√°gina (OCR) |

---

## Ap√©ndice: Diferencias entre scripts

| Script | Ruta entrada | Ruta salida |
|--------|--------------|-------------|
| `codigo-PDF.py` | `...\BAJA CALIFORNIA\Codigos` | `...\contenido\codigo-contenido.json` |
| `leyes-PDF.py` | `...\BAJA CALIFORNIA\Leyes` | `...\contenido\leyes-contenido.json` |
| `reglamentos-PDF.py` | `...\BAJA CALIFORNIA\Reglamentos` | `...\contenido\reglamentos-contenido.json` |

**Nota:** Los 3 scripts comparten el 100% del c√≥digo de procesamiento. Solo difieren en las rutas configuradas en `main()`.

---

> **√öltima actualizaci√≥n de documentaci√≥n:** Noviembre 2025

